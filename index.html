<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sualtƒ± Akademisi - ELƒ∞T VERSƒ∞YON</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700&display=swap');

        :root {
            --primary: #FF6F00;
            --secondary: #0288D1;
            --success: #43A047; /* KOYU YE≈ûƒ∞L */
            --bg-gradient: linear-gradient(135deg, #E0F7FA 0%, #81D4FA 100%);
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Nunito', sans-serif;
            background: var(--bg-gradient);
            height: 100vh; overflow: hidden;
            user-select: none;
            display: flex; justify-content: center; align-items: center;
        }

        /* Y√úKLEME EKRANI */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0288D1; color: white; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 9999;
            transition: opacity 0.5s;
        }

        /* 5 SANƒ∞YELƒ∞K Eƒûƒ∞Tƒ∞M PERDESƒ∞ (YENƒ∞) */
        #tutorial-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); z-index: 50;
            display: none; /* JS ile a√ßƒ±lacak */
            flex-direction: column; align-items: center; justify-content: center;
            color: white; border-radius: 25px;
        }
        .tut-icon { font-size: 100px; margin: 20px; animation: pulse 1s infinite; }
        .countdown { font-size: 60px; font-family: 'Fredoka One', cursive; color: #FFD700; margin-top: 20px; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }

        /* ANA KUTU */
        #app-container {
            width: 95%; max-width: 900px; height: 95vh;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,50,0.3);
            display: flex; flex-direction: column;
            overflow: hidden;
            border: 5px solid white;
            position: relative;
            z-index: 10;
        }

        header {
            padding: 15px; display: flex; justify-content: space-between; align-items: center;
            background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 20;
        }
        .score-board { font-family: 'Fredoka One', cursive; color: var(--primary); font-size: 1.5rem; }
        .progress-bar { width: 40%; height: 20px; background: #eee; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; background: #00C853; transition: width 0.5s ease; }

        /* SAHNELER */
        .scene {
            flex: 1; display: none;
            flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 10px; overflow-y: auto;
        }
        #scene-intro { display: flex; }

        .scene.active { display: flex !important; animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* BUTONLAR */
        .btn {
            background: linear-gradient(180deg, #FFCA28 0%, #FF6F00 100%);
            border: none; border-bottom: 5px solid #E65100;
            color: white; padding: 15px 35px; font-size: 1.3rem;
            font-family: 'Fredoka One', cursive; border-radius: 50px;
            cursor: pointer; margin: 10px; transition: transform 0.1s;
        }
        .btn:active { transform: translateY(4px); border-bottom: 2px solid #E65100; }
        .btn-blue { background: linear-gradient(180deg, #4FC3F7 0%, #0288D1 100%); border-bottom-color: #01579B; }
        .btn-green { background: linear-gradient(180deg, #69F0AE 0%, #00C853 100%); border-bottom-color: #00695C; }

        /* G√ñLGE OYUNU */
        .shadow-grid { display: flex; gap: 20px; margin-top: 20px; justify-content: center; }
        .shadow-card { 
            width: 100px; height: 100px; background: white; 
            border: 4px solid #BBDEFB; border-radius: 20px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 60px; cursor: pointer; transition: transform 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .shadow-card:hover { transform: scale(1.1); border-color: #FF6F00; }
        .silhouette { filter: brightness(0) !important; opacity: 0.8; } 
        
        /* YE≈ûƒ∞L MESAJ STƒ∞Lƒ∞ (ƒ∞STEƒûƒ∞N √úZERƒ∞NE) */
        .msg-correct { 
            color: var(--success) !important; 
            font-size: 2rem !important; 
            font-weight: bold; 
            text-shadow: 0px 2px 0px rgba(0,0,0,0.1);
            animation: popIn 0.3s;
        }
        .msg-wrong { color: #D32F2F !important; font-weight: bold; }

        /* ROBOT YENGE√á */
        .grid-wrapper { background: #E1F5FE; padding: 15px; border-radius: 20px; border: 3px solid #B3E5FC; }
        .grid-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; width: 280px; height: 280px; }
        .grid-cell { background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 35px; transition: 0.2s; }
        .crash { background-color: #ffcdd2 !important; animation: shake 0.4s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; width: 220px; }
        .ctrl-btn { font-size: 30px; padding: 15px; border-radius: 15px; margin: 0; }

        /* BOYAMA */
        .paint-area { display: flex; gap: 20px; margin: 20px 0; justify-content: center; }
        .paint-shape {
            width: 100px; height: 100px; background: #eee; border: 4px dashed #999;
            border-radius: 20px; font-size: 60px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s;
        }
        .paint-shape.correct { border-style: solid; border-color: #4CAF50; animation: popIn 0.5s; }
        .colors { display: flex; gap: 15px; margin-top: 20px; background: white; padding: 10px; border-radius: 50px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .swatch { width: 50px; height: 50px; border-radius: 50%; border: 4px solid white; cursor: pointer; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .swatch.selected { transform: scale(1.2); border-color: #333; }

        #confetti-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
    </style>
</head>
<body>

<div id="loader"><h1>Y√ºkleniyor...</h1></div>
<canvas id="confetti-canvas"></canvas>

<div id="app-container">
    
    <div id="tutorial-overlay">
        <h2 id="tut-title" style="font-size: 2rem;">Hazƒ±r mƒ±sƒ±n?</h2>
        <div id="tut-icon" class="tut-icon">üöÄ</div>
        <p id="tut-desc" style="font-size: 1.2rem;">Oyun Ba≈ülƒ±yor...</p>
        <div id="tut-count" class="countdown">5</div>
    </div>

    <header>
        <div class="score-board">‚≠ê <span id="stars">0</span></div>
        <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
    </header>

    <div id="scene-intro" class="scene active">
        <h1 style="color:#0277BD; font-size:3rem;">Sualtƒ± Akademisi</h1>
        <div style="font-size:100px; animation: popIn 2s infinite;">üêô</div>
        <p>Maceraya Hazƒ±r mƒ±sƒ±n?</p>
        <button class="btn" onclick="startGame()">OYUNA BA≈ûLA ‚ñ∂</button>
    </div>

    <div id="scene-menu" class="scene">
        <h2>G√∂rev Se√ßimi</h2>
        <div style="display:flex; flex-wrap:wrap; justify-content:center;">
            <button class="btn btn-blue" onclick="startTutorial('shadow')">üß© G√∂lge Dedektifi</button>
            <button class="btn btn-blue" onclick="startTutorial('crab')">ü¶Ä Robot Yenge√ß</button>
            <button class="btn btn-blue" onclick="startTutorial('paint')">üé® Renk Ustasƒ±</button>
        </div>
    </div>

    <div id="scene-shadow" class="scene">
        <h2 id="shadow-title">G√∂lgeyi Bul (1/3)</h2>
        <div id="shadow-target" style="font-size: 100px; margin-bottom: 20px;">ü¶Ä</div>
        <div class="shadow-grid" id="shadow-options"></div>
        <p id="shadow-msg" style="height:40px; margin-top:10px;"></p>
        <button class="btn btn-secondary" onclick="switchScene('scene-menu')">√áƒ±kƒ±≈ü</button>
    </div>

    <div id="scene-crab" class="scene">
        <h2>Yƒ±ldƒ±za Ula≈ü!</h2>
        <div class="grid-wrapper">
            <div class="grid-container" id="game-grid"></div>
        </div>
        <div class="controls">
            <div></div><button class="btn btn-green ctrl-btn" onclick="moveCrab(0, -1)">‚¨Ü</button><div></div>
            <button class="btn btn-green ctrl-btn" onclick="moveCrab(-1, 0)">‚¨Ö</button>
            <button class="btn btn-green ctrl-btn" onclick="moveCrab(0, 1)">‚¨á</button>
            <button class="btn btn-green ctrl-btn" onclick="moveCrab(1, 0)">‚û°</button>
        </div>
        <button class="btn btn-secondary" style="margin-top:10px" onclick="switchScene('scene-menu')">√áƒ±kƒ±≈ü</button>
    </div>

    <div id="scene-paint" class="scene">
        <h2>Renkleri E≈üle≈ütir!</h2>
        <div class="paint-area">
            <div id="shape-star" class="paint-shape" onclick="paintShape('star')">‚≠ê</div>
            <div id="shape-heart" class="paint-shape" onclick="paintShape('heart')">‚ù§Ô∏è</div>
            <div id="shape-fish" class="paint-shape" onclick="paintShape('fish')">üêü</div>
        </div>
        <p>Se√ßilen Renk: <span id="current-color-name" style="font-weight:bold;">YOK</span></p>
        <div class="colors">
            <div class="swatch" style="background:#FFD700" onclick="selectColor('#FFD700', 'SARI', this)"></div>
            <div class="swatch" style="background:#F44336" onclick="selectColor('#F44336', 'KIRMIZI', this)"></div>
            <div class="swatch" style="background:#2196F3" onclick="selectColor('#2196F3', 'MAVƒ∞', this)"></div>
        </div>
        <button class="btn btn-secondary" style="margin-top:20px" onclick="switchScene('scene-menu')">√áƒ±kƒ±≈ü</button>
    </div>

    <div id="scene-final" class="scene">
        <h1>üéâ TEBRƒ∞KLER! üéâ</h1>
        <div style="font-size: 100px;">üèÜ</div>
        <p>B√ºt√ºn g√∂revleri tamamladƒ±n!</p>
        <button class="btn" onclick="location.reload()">Tekrar Oyna ‚Ü∫</button>
    </div>

</div>

<script>
    // --- SES Sƒ∞STEMƒ∞ ---
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioCtx = new AudioContext();

    function playTone(freq, type, dur) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
        osc.type = type; osc.frequency.value = freq;
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
        osc.stop(audioCtx.currentTime + dur);
    }
    
    function sfxClick() { playTone(400, 'sine', 0.1); }
    function sfxCorrect() { playTone(600, 'sine', 0.1); setTimeout(function(){ playTone(800, 'sine', 0.2); }, 100); }
    function sfxError() { playTone(200, 'sawtooth', 0.3); }

    function speak(text) {
        if('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            let u = new SpeechSynthesisUtterance(text);
            u.lang = 'tr-TR';
            window.speechSynthesis.speak(u);
        }
    }

    // --- GENEL ---
    document.addEventListener("DOMContentLoaded", function() {
        document.getElementById('loader').style.opacity = '0';
        setTimeout(function() { document.getElementById('loader').style.display = 'none'; }, 500);
        switchScene('scene-intro');
    });

    function startGame() {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        switchScene('scene-menu');
        speak("Ho≈ügeldin");
    }

    function switchScene(id) {
        const scenes = document.querySelectorAll('.scene');
        for (let i = 0; i < scenes.length; i++) {
            scenes[i].classList.remove('active');
            scenes[i].style.display = 'none';
        }
        const active = document.getElementById(id);
        active.style.display = 'flex';
        setTimeout(function() { active.classList.add('active'); }, 10);
        sfxClick();
    }

    // --- YENƒ∞ Eƒûƒ∞Tƒ∞M (TUTORIAL) MODU ---
    function startTutorial(gameType) {
        const overlay = document.getElementById('tutorial-overlay');
        const title = document.getElementById('tut-title');
        const desc = document.getElementById('tut-desc');
        const icon = document.getElementById('tut-icon');
        const countDisplay = document.getElementById('tut-count');
        
        // ƒ∞√ßeriƒüi oyuna g√∂re ayarla
        if(gameType === 'shadow') {
            title.innerText = "G√∂lge Avƒ±";
            desc.innerText = "Doƒüru g√∂lgeyi bul!";
            icon.innerText = "‚ùì";
            speak("Dikkatli bak, g√∂lgeyi bul.");
        } else if(gameType === 'crab') {
            title.innerText = "Robot Yenge√ß";
            desc.innerText = "Ok tu≈ülarƒ± ile yƒ±ldƒ±za git!";
            icon.innerText = "üéÆ";
            speak("Ok tu≈ülarƒ±nƒ± kullan.");
        } else if(gameType === 'paint') {
            title.innerText = "Renk Ustasƒ±";
            desc.innerText = "Doƒüru renge boya!";
            icon.innerText = "üñåÔ∏è";
            speak("Renkleri e≈üle≈ütir.");
        }

        overlay.style.display = 'flex'; // G√∂ster

        let counter = 5;
        countDisplay.innerText = counter;

        let timer = setInterval(function() {
            counter--;
            countDisplay.innerText = counter;
            if(counter <= 0) {
                clearInterval(timer);
                overlay.style.display = 'none'; // Gizle
                // Oyunu Ba≈ülat
                if(gameType === 'shadow') startShadowGame();
                else if(gameType === 'crab') startCrabGame();
                else if(gameType === 'paint') startPaintGame();
            }
        }, 1000);
    }

    // --- G√ñLGE OYUNU ---
    const animals = ['ü¶Ä','üê¨','üêô','üê¢','üê†','üêö'];
    let shadowLevel = 0;
    let currentShadowTarget = "";

    function startShadowGame() {
        shadowLevel = 0;
        loadShadowLevel();
    }

    function loadShadowLevel() {
        if(shadowLevel >= 3) { completeModule(); return; }
        switchScene('scene-shadow');
        document.getElementById('shadow-title').innerText = "G√∂lgeyi Bul (" + (shadowLevel+1) + "/3)";
        document.getElementById('shadow-msg').innerText = "";
        
        currentShadowTarget = animals[Math.floor(Math.random() * animals.length)];
        document.getElementById('shadow-target').innerText = currentShadowTarget;
        
        let opts = [currentShadowTarget];
        while(opts.length < 3) {
            let r = animals[Math.floor(Math.random() * animals.length)];
            if(opts.indexOf(r) === -1) opts.push(r);
        }
        opts.sort(function() { return Math.random() - 0.5; });

        let html = "";
        for(let i=0; i<opts.length; i++) {
            html += '<div class="shadow-card" onclick="checkShadow(\'' + opts[i] + '\')"><span class="silhouette">' + opts[i] + '</span></div>';
        }
        document.getElementById('shadow-options').innerHTML = html;
    }

    function checkShadow(selected) {
        let msgBox = document.getElementById('shadow-msg');
        if(selected === currentShadowTarget) {
            sfxCorrect();
            // YE≈ûƒ∞L YAZI AYARI
            msgBox.innerText = "DOƒûRU!";
            msgBox.className = "msg-correct"; // Ye≈üil stil class'ƒ±
            
            shadowLevel++;
            setTimeout(function() {
                msgBox.innerText = "";
                loadShadowLevel();
            }, 1000);
        } else {
            sfxError();
            msgBox.innerText = "Tekrar dene!";
            msgBox.className = "msg-wrong"; // Kƒ±rmƒ±zƒ± stil class'ƒ±
            speak("Yanlƒ±≈ü");
        }
    }

    // --- ROBOT YENGE√á ---
    let playerPos = {x:0, y:0};
    let targetPos = {x:3, y:3};
    let rocks = [];

    function startCrabGame() {
        switchScene('scene-crab');
        playerPos = {x:0, y:0};
        rocks = [];
        while(rocks.length < 3) {
            let rx = Math.floor(Math.random()*4); 
            let ry = Math.floor(Math.random()*4);
            if((rx!==0 || ry!==0) && (rx!==3 || ry!==3)) {
                let exists = false;
                for(let i=0; i<rocks.length; i++) if(rocks[i].x===rx && rocks[i].y===ry) exists=true;
                if(!exists) rocks.push({x:rx, y:ry});
            }
        }
        renderGrid();
    }

    function renderGrid() {
        const grid = document.getElementById('game-grid'); grid.innerHTML = '';
        for(let y=0; y<4; y++) for(let x=0; x<4; x++) {
            let cell = document.createElement('div'); cell.className = 'grid-cell';
            if(x===playerPos.x && y===playerPos.y) cell.innerHTML = 'ü¶Ä';
            else if(x===targetPos.x && y===targetPos.y) cell.innerHTML = '‚≠ê';
            else {
                let isRock = false;
                for(let i=0; i<rocks.length; i++) if(rocks[i].x===x && rocks[i].y===y) isRock=true;
                if(isRock) cell.innerHTML = 'ü™®';
            }
            grid.appendChild(cell);
        }
    }

    function moveCrab(dx, dy) {
        let nx = playerPos.x + dx; let ny = playerPos.y + dy;
        let isRock = false;
        for(let i=0; i<rocks.length; i++) if(rocks[i].x===nx && rocks[i].y===ny) isRock=true;
        
        if(nx<0 || nx>3 || ny<0 || ny>3 || isRock) {
            sfxError();
            let idx = playerPos.y*4 + playerPos.x;
            let cells = document.querySelectorAll('.grid-cell');
            if(cells[idx]) cells[idx].classList.add('crash');
            setTimeout(renderGrid, 500);
            return;
        }
        playerPos = {x:nx, y:ny};
        sfxClick();
        renderGrid();
        if(playerPos.x===targetPos.x && playerPos.y===targetPos.y) setTimeout(completeModule, 500);
    }

    // --- BOYAMA ---
    let selectedColor = null;
    let selectedColorName = "";
    let paintStatus = { star: false, heart: false, fish: false };

    function startPaintGame() {
        switchScene('scene-paint');
        selectedColor = null; paintStatus = { star: false, heart: false, fish: false };
        document.getElementById('current-color-name').innerText = "YOK";
        ['star','heart','fish'].forEach(s => {
            let el = document.getElementById('shape-'+s);
            el.style.background="#eee"; el.style.color="#333"; el.classList.remove('correct');
        });
    }

    function selectColor(code, name, el) {
        selectedColor = code; selectedColorName = name;
        let lbl = document.getElementById('current-color-name');
        lbl.innerText = name; lbl.style.color = code;
        sfxClick();
        document.querySelectorAll('.swatch').forEach(s => s.classList.remove('selected'));
        if(el) el.classList.add('selected');
    }

    function paintShape(shape) {
        if(!selectedColor) { speak("Renk se√ß"); return; }
        let cor = (shape==='star')?'#FFD700':(shape==='heart')?'#F44336':'#2196F3';
        if(selectedColor === cor) {
            sfxCorrect();
            let el = document.getElementById('shape-'+shape);
            el.style.background = selectedColor; el.style.color = "white"; el.classList.add('correct');
            paintStatus[shape] = true;
            if(paintStatus.star && paintStatus.heart && paintStatus.fish) setTimeout(completeModule, 1000);
        } else {
            sfxError(); speak("Yanlƒ±≈ü renk");
        }
    }

    // --- MODULE TAMAMLAMA ---
    let stars = 0; let totalProgress = 0;
    function completeModule() {
        stars++; totalProgress += 34;
        document.getElementById('stars').innerText = stars;
        document.getElementById('progress').style.width = Math.min(totalProgress, 100) + "%";
        triggerConfetti(); speak("Harika!");
        if(totalProgress >= 100) setTimeout(function() { switchScene('scene-final'); }, 2500);
        else setTimeout(function() { switchScene('scene-menu'); }, 2000);
    }

    // --- KONFETƒ∞ ---
    function triggerConfetti() {
        const c = document.getElementById('confetti-canvas'); const cx = c.getContext('2d');
        c.width = window.innerWidth; c.height = window.innerHeight;
        let p=[]; for(let i=0;i<100;i++) p.push({x:Math.random()*c.width, y:Math.random()*c.height-c.height, c:'hsl('+(Math.random()*360)+',100%,50%)', v:Math.random()*5+2});
        function loop() {
            cx.clearRect(0,0,c.width,c.height); let act=false;
            p.forEach(x=>{ x.y+=x.v; if(x.y<c.height){act=true; cx.fillStyle=x.c; cx.fillRect(x.x,x.y,10,10)} });
            if(act) requestAnimationFrame(loop);
        } loop();
    }
</script>
</body>
</html>